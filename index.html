<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Cacing Arena Pro: Mabar Edition</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/peerjs/1.5.2/peerjs.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; user-select: none; -webkit-user-select: none; }
        body { 
            background: #000; 
            overflow: hidden; 
            touch-action: none; 
            position: fixed; 
            width: 100%; 
            height: 100%; 
            color: white; 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
        }
        canvas { 
            display: block; 
            background: linear-gradient(135deg, #050510 0%, #0a0a1a 100%); 
            cursor: none; 
        }
        
        /* UI Layers */
        #ui-layer { 
            position: absolute; 
            inset: 0; 
            z-index: 100; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            background: radial-gradient(circle at center, rgba(0,0,0,0.9) 0%, rgba(0,0,0,0.95) 100%); 
            backdrop-filter: blur(5px); 
        }
        #room-layer { 
            position: absolute; 
            inset: 0; 
            z-index: 101; 
            display: none; 
            justify-content: center; 
            align-items: center; 
            background: rgba(0,0,0,0.95); 
        }
        #shop-layer { 
            position: absolute; 
            inset: 0; 
            z-index: 102; 
            display: none; 
            justify-content: center; 
            align-items: center; 
            background: rgba(0,0,0,0.97); 
            overflow-y: auto; 
            padding: 20px; 
        }
        
        /* Panels */
        .panel { 
            background: linear-gradient(135deg, #111122, #1a1a2e); 
            padding: 30px; 
            border-radius: 25px; 
            border: 3px solid #a855f7; 
            width: 90%; 
            max-width: 450px; 
            text-align: center; 
            box-shadow: 0 0 40px rgba(168,85,247,0.4), 
                        inset 0 0 20px rgba(255,255,255,0.05); 
            animation: panel-glow 3s ease-in-out infinite alternate; 
        }
        @keyframes panel-glow {
            from { box-shadow: 0 0 30px rgba(168,85,247,0.4); }
            to { box-shadow: 0 0 50px rgba(168,85,247,0.6); }
        }
        .panel h2 { 
            color: #a855f7; 
            margin-bottom: 25px; 
            font-size: 1.8em; 
            text-shadow: 0 0 10px rgba(168,85,247,0.5); 
        }
        
        /* Inputs & Buttons */
        input { 
            width: 100%; 
            padding: 15px; 
            margin-bottom: 15px; 
            border-radius: 12px; 
            border: 2px solid #333344; 
            background: rgba(30,30,45,0.8); 
            color: #fff; 
            text-align: center; 
            font-size: 16px; 
            font-weight: 500; 
            transition: all 0.3s ease; 
        }
        input:focus { 
            outline: none; 
            border-color: #a855f7; 
            box-shadow: 0 0 15px rgba(168,85,247,0.3); 
            background: rgba(40,40,60,0.9); 
        }
        .btn { 
            width: 100%; 
            padding: 16px; 
            margin: 10px 0; 
            border-radius: 15px; 
            border: none; 
            font-weight: bold; 
            cursor: pointer; 
            color: white; 
            font-size: 16px; 
            transition: all 0.3s ease; 
            position: relative; 
            overflow: hidden; 
            letter-spacing: 0.5px; 
        }
        .btn::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }
        .btn:hover::after {
            left: 100%;
        }
        .btn:hover { 
            transform: translateY(-3px); 
            filter: brightness(1.2); 
            box-shadow: 0 5px 20px rgba(0,0,0,0.3); 
        }
        .btn:active { 
            transform: translateY(0); 
        }
        .btn-play { 
            background: linear-gradient(135deg, #a855f7, #7c3aed); 
            border: 2px solid #8b5cf6; 
        }
        .btn-mabar { 
            background: linear-gradient(135deg, #3b82f6, #1d4ed8); 
            border: 2px solid #60a5fa; 
        }
        .btn-room { 
            background: linear-gradient(135deg, #10b981, #059669); 
            border: 2px solid #34d399; 
        }
        .btn-exit { 
            background: linear-gradient(135deg, #ef4444, #dc2626); 
            border: 2px solid #f87171; 
        }
        .btn-shop { 
            background: linear-gradient(135deg, #f59e0b, #d97706); 
            border: 2px solid #fbbf24; 
        }
        
        /* HUD */
        #hud { 
            position: absolute; 
            top: 20px; 
            left: 20px; 
            z-index: 50; 
            display: none; 
            gap: 10px; 
        }
        .badge { 
            background: rgba(20,20,40,0.85); 
            padding: 12px 20px; 
            border-radius: 20px; 
            border: 2px solid #a855f7; 
            display: flex; 
            align-items: center; 
            gap: 8px; 
            backdrop-filter: blur(10px); 
            box-shadow: 0 4px 15px rgba(0,0,0,0.3); 
            min-width: 120px; 
        }
        .badge span { 
            font-weight: bold; 
            font-size: 1.1em; 
        }
        #room-info { 
            position: absolute; 
            top: 20px; 
            right: 20px; 
            z-index: 50; 
            display: none; 
            background: rgba(20,20,40,0.85); 
            padding: 12px 20px; 
            border-radius: 20px; 
            border: 2px solid #3b82f6; 
            backdrop-filter: blur(10px); 
        }
        
        /* Chat System */
        #chat-container { 
            position: absolute; 
            bottom: 100px; 
            left: 20px; 
            z-index: 50; 
            display: none; 
            width: 300px; 
            max-height: 200px; 
            background: rgba(20,20,40,0.9); 
            border-radius: 15px; 
            border: 2px solid #10b981; 
            overflow: hidden; 
            backdrop-filter: blur(10px); 
        }
        #chat-header { 
            background: rgba(16,185,129,0.3); 
            padding: 10px; 
            font-weight: bold; 
            text-align: center; 
            border-bottom: 2px solid #10b981; 
        }
        #chat-messages { 
            height: 150px; 
            overflow-y: auto; 
            padding: 10px; 
            font-size: 14px; 
        }
        .chat-message { 
            margin-bottom: 5px; 
            padding: 5px 8px; 
            border-radius: 10px; 
            background: rgba(255,255,255,0.1); 
            word-break: break-word; 
        }
        .chat-message.own { 
            background: rgba(168,85,247,0.3); 
            text-align: right; 
        }
        #chat-input-container { 
            display: flex; 
            padding: 10px; 
            gap: 5px; 
        }
        #chat-input { 
            flex: 1; 
            padding: 8px; 
            border-radius: 10px; 
            border: 1px solid #444; 
            background: rgba(30,30,45,0.8); 
            color: white; 
            font-size: 14px; 
        }
        #chat-send { 
            padding: 8px 15px; 
            border-radius: 10px; 
            border: none; 
            background: #10b981; 
            color: white; 
            font-weight: bold; 
            cursor: pointer; 
        }
        #chat-toggle { 
            position: absolute; 
            bottom: 100px; 
            left: 20px; 
            width: 40px; 
            height: 40px; 
            border-radius: 50%; 
            background: #10b981; 
            border: none; 
            color: white; 
            font-size: 20px; 
            cursor: pointer; 
            z-index: 51; 
            display: none; 
            justify-content: center; 
            align-items: center; 
            box-shadow: 0 4px 10px rgba(0,0,0,0.3); 
        }
        
        /* Player List */
        #player-list {
            position: absolute;
            bottom: 100px;
            right: 20px;
            z-index: 50;
            display: none;
            background: rgba(20, 20, 40, 0.9);
            padding: 8px;
            width: 150px;
            max-height: 180px;
            border-radius: 10px;
            cursor: move;
            touch-action: none;
            user-select: none;
            backdrop-filter: blur(10px);
            border: 2px solid #3b82f6;
            overflow-y: auto;
        }
        .player-item { 
            padding: 8px 10px; 
            border-bottom: 1px solid rgba(255,255,255,0.1); 
            display: flex; 
            align-items: center; 
            gap: 10px; 
        }
        .player-color { 
            width: 12px; 
            height: 12px; 
            border-radius: 50%; 
            flex-shrink: 0; 
        }
        .player-name { 
            flex: 1; 
            overflow: hidden; 
            text-overflow: ellipsis; 
            white-space: nowrap; 
        }
        .player-score { 
            font-weight: bold; 
            color: #f59e0b; 
        }
        
        /* Shop Items */
        .shop-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); 
            gap: 15px; 
            margin-top: 20px; 
            max-height: 400px; 
            overflow-y: auto; 
            padding: 10px; 
        }
        .shop-item { 
            background: rgba(30,30,45,0.9); 
            border-radius: 15px; 
            padding: 15px; 
            text-align: center; 
            border: 2px solid #444; 
            transition: all 0.3s ease; 
            cursor: pointer; 
        }
        .shop-item:hover { 
            border-color: #f59e0b; 
            transform: translateY(-5px); 
            box-shadow: 0 5px 15px rgba(245,158,11,0.3); 
        }
        .shop-item.equipped { 
            border-color: #10b981; 
            background: rgba(16,185,129,0.1); 
        }
        .shop-item.owned { 
            border-color: #a855f7; 
        }
        .shop-item.locked { 
            opacity: 0.5; 
            filter: grayscale(1); 
        }
        .shop-icon { 
            font-size: 40px; 
            margin-bottom: 10px; 
            display: block; 
        }
        .shop-price { 
            color: gold; 
            font-weight: bold; 
            margin: 8px 0; 
        }
        
        /* Joystick */
        #joy-zone { 
            position: absolute; 
            bottom: 50px; 
            left: 50px; 
            width: 160px; 
            height: 160px; 
            z-index: 50; 
            display: none;
            touch-action: none; 
        }
        .joy-base { 
            
            width: 100%; 
            height: 100%; 
            background: radial-gradient(circle, rgba(255,255,255,0.05) 0%, rgba(168,85,247,0.1) 100%); 
            border-radius: 50%; 
            border: 2px solid rgba(168,85,247,0.5); 
            backdrop-filter: blur(15px); 
            box-shadow: 0 0 30px rgba(168,85,247,0.2), 
                        inset 0 0 10px rgba(255,255,255,0.05); 
        }
        .joy-stick { 
            width: 70px; 
            height: 70px; 
            background: radial-gradient(circle, #a855f7 0%, #7c3aed 100%); 
            border-radius: 50%; 
            position: absolute; 
            top: 45px; 
            left: 45px; 
            box-shadow: 0 0 20px rgba(168,85,247,0.8), 
                        inset 0 0 10px rgba(255,255,255,0.3); 
            transition: transform 0.1s ease; 
        }
        
        /* Minimap */
        #minimap { 
            position: absolute; 
            bottom: 50px; 
            right: 50px; 
            width: 180px; 
            height: 180px; 
            z-index: 50; 
            display: none; 
            background: rgba(20,20,40,0.9); 
            border-radius: 15px; 
            border: 3px solid #3b82f6; 
            overflow: hidden; 
            backdrop-filter: blur(10px); 
            box-shadow: 0 0 20px rgba(59,130,246,0.3); 
        }
        #minimap-canvas { 
            width: 100%; 
            height: 100%; 
            display: block; 
        }
        
        /* Effect Overlays */
        #speed-effect { 
            position: absolute; 
            inset: 0; 
            z-index: 25; 
            display: none; 
            pointer-events: none; 
            background: radial-gradient(circle at center, transparent 30%, rgba(168,85,247,0.1) 70%, rgba(168,85,247,0.2) 100%); 
            animation: speed-pulse 0.5s ease-in-out infinite alternate; 
        }
        @keyframes speed-pulse {
            from { opacity: 0.3; }
            to { opacity: 0.6; }
        }
        #magnet-effect { 
            position: absolute; 
            inset: 0; 
            z-index: 24; 
            display: none; 
            pointer-events: none; 
            background: radial-gradient(circle at center, transparent 40%, rgba(245,158,11,0.1) 60%, rgba(245,158,11,0.15) 100%); 
        }
        
        /* Utility */
        .hidden { display: none !important; }
        .error { color: #ef4444; margin-top: 10px; font-size: 14px; padding: 8px; background: rgba(239,68,68,0.1); border-radius: 8px; }
        .success { color: #10b981; margin-top: 10px; font-size: 14px; padding: 8px; background: rgba(16,185,129,0.1); border-radius: 8px; }
        .info { color: #3b82f6; margin-top: 10px; font-size: 14px; }
        
        /* Audio Controls */
        #audio-controls { 
            position: absolute; 
            top: 20px; 
            left: 50%; 
            transform: translateX(-50%); 
            z-index: 60; 
            display: none; 
            gap: 10px; 
        }
        .audio-btn { 
            background: rgba(20,20,40,0.9); 
            width: 40px; 
            height: 40px; 
            border-radius: 50%; 
            border: 2px solid #3b82f6; 
            color: white; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            cursor: pointer; 
            font-size: 20px; 
            backdrop-filter: blur(10px); 
        }
        
        /* Loading Screen */
        #loading { 
            position: absolute; 
            inset: 0; 
            z-index: 999; 
            background: #000; 
            display: flex; 
            flex-direction: column; 
            justify-content: center; 
            align-items: center; 
            font-size: 24px; 
            gap: 20px; 
        }
        .spinner { 
            width: 50px; 
            height: 50px; 
            border: 5px solid #333; 
            border-top: 5px solid #a855f7; 
            border-radius: 50%; 
            animation: spin 1s linear infinite; 
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Mobile Optimizations */
        @media (max-width: 768px) {
            .panel { padding: 20px; }
            #chat-container { width: 250px; }
            #player-list { width: 180px; }
            #joy-zone { width: 140px; height: 140px; left: 30px; bottom: 30px; }
            joy-stick { width: 60px; height: 60px; top: 40px; left: 40px; }
            #minimap { width: 150px; height: 150px; right: 30px; bottom: 30px; }
        }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: rgba(255,255,255,0.05); border-radius: 4px; }
        ::-webkit-scrollbar-thumb { background: #a855f7; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #7c3aed; }
    </style>
</head>
<body>

    <div id="loading">
        <div class="spinner"></div>
        <p>Loading Game Assets...</p>
    </div>

    <canvas id="game"></canvas>

    <!-- Effect Overlays -->
    <div id="speed-effect"></div>
    <div id="magnet-effect"></div>

    <!-- Main Menu -->
    <div id="ui-layer">
        <div class="panel">
            <h1 style="color:#a855f7; margin-bottom:15px; font-size: 2.2em; text-shadow: 0 0 20px rgba(168,85,247,0.7);">üêç CACING ARENA PRO</h1>
            <input type="text" id="nick" placeholder="Masukkan Nickname" value="Jagoan" maxlength="12">
            <button class="btn btn-play" onclick="Game.startSolo()">üéÆ MAIN SOLO</button>
            <button class="btn btn-mabar" onclick="Room.show()">üë• MABAR LAN</button>
            <button class="btn btn-shop" onclick="Shop.show()">üõí TOKO SKIN</button>
            <p style="margin-top:20px; color: gold; font-size: 20px; font-weight: bold;">
                ü™ô <span id="menu-coin">0</span> Koin
            </p>
            <div class="info" style="margin-top:15px;">
                üî• Makan makanan, makan bot, dan jadi yang terbesar!
            </div>
        </div>
    </div>

    <!-- Room Menu -->
    <div id="room-layer">
        <div class="panel">
            <h2>üéÆ ROOM MABAR</h2>
            <input type="text" id="room-id" placeholder="Kode Room (4 digit)" maxlength="4" pattern="[0-9]{4}">
            <button class="btn btn-room" onclick="Room.join()">‚úÖ GABUNG ROOM</button>
            <button class="btn btn-room" onclick="Room.create()">üÜï BUAT ROOM BARU</button>
            <button class="btn btn-exit" onclick="Room.hide()">‚¨ÖÔ∏è KEMBALI</button>
            <div id="room-status" class="error"></div>
            <div class="info">
                ü§ù Main dengan teman dalam satu WiFi!<br>
                Buat room dan beri kode ke temanmu.
            </div>
        </div>
    </div>

    <!-- Shop -->
    <div id="shop-layer">
        <div class="panel" style="max-width: 800px;">
            <h2>üõí TOKO SKIN & POWER-UP</h2>
            <div class="shop-grid" id="shop-items"></div>
            <div style="margin-top: 20px;">
                <button class="btn btn-exit" onclick="Shop.hide()">‚¨ÖÔ∏è KEMBALI KE MENU</button>
            </div>
            <div class="info" style="margin-top: 15px;">
                üí∞ Koin Anda: <span id="shop-coins" style="color:gold; font-weight:bold;">0</span>
            </div>
        </div>
    </div>

    <!-- HUD -->
    <div id="hud">
        <div class="badge">ü™ô <span id="coins">0</span></div>
        <div class="badge">üìè <span id="score">0</span></div>
        <div class="badge">üë• <span id="player-count">1</span></div>
        <div class="badge">‚ö° <span id="speed-boost">0%</span></div>
    </div>
    
    <div id="room-info">
        üéÆ ROOM: <span id="room-code">----</span>
    </div>
    
    <!-- Chat System -->
    <button id="chat-toggle" onclick="Chat.toggle()">üí¨</button>
    <div id="chat-container">
        <div id="chat-header">üí¨ Chat Room</div>
        <div id="chat-messages"></div>
        <div id="chat-input-container">
            <input type="text" id="chat-input" placeholder="Ketik pesan..." maxlength="100">
            <button id="chat-send" onclick="Chat.send()">Kirim</button>
        </div>
    </div>
    
    <!-- Player List -->
    <div id="player-list">
        <h4 style="margin-bottom:10px; color:#3b82f6;">üë• PEMAIN:</h4>
        <div id="players-container"></div>
    </div>
    
    <!-- Minimap -->
    <div id="minimap">
        <canvas id="minimap-canvas"></canvas>
    </div>

    <!-- Audio Controls -->
    <div id="audio-controls">
        <button class="audio-btn" onclick="Audio.toggleMusic()" id="music-btn">üéµ</button>
        <button class="audio-btn" onclick="Audio.toggleSFX()" id="sfx-btn">üîä</button>
    </div>


    <!-- Audio Elements -->
    <audio id="bg-music" loop>
        <source src="" type="audio/mpeg">
    </audio>
    <audio id="eat-sound" preload="auto">
        <source src="" type="audio/mpeg">
    </audio>
    <audio id="collision-sound" preload="auto">
        <source src="" type="audio/mpeg">
    </audio>
    <audio id="powerup-sound" preload="auto">
        <source src="" type="audio/mpeg">
    </audio>
    <audio id="chat-sound" preload="auto">
        <source src="" type="audio/mpeg">
    </audio>

    <!-- Scripts -->
    <script src="skin.js"></script>
    <script src="ui-handler.js"></script>
    <script src="game.js"></script>
    <script src="bot-combat.js"></script>
</body>
</html>
